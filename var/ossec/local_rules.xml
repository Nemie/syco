<!-- @(#) $Id$

Modified to work in PCI-DSS systems.

__author__ = "matte@elino.se"
__copyright__ = "Copyright 2011, The System Console project"
__maintainer__ = "Daniel Lindh"
__email__ = "syco@cybercow.se"
__credits__ = ["Daniel LIndh"]
__license__ = "???"
__version__ = "1.0.0"
__status__ = "Production"

-->

<group name="forcefield">

<!-- ALERT ON NEW FILES" -->
<rule id="554" level="7" overwrite="yes">
	<category>ossec</category>
	<decoded_as>syscheck_new_entry</decoded_as>
	<description>File added to the system.</description>
	<group>syscheck,</group>
</rule>

<!-- ALERT ON WORLD WIDE FILES -->
<rule id="100018" level="7">
	<if_group>syscheck,</if_group>
	<regex>Permissions changed from ‘\D+’ to ‘\D\D\D\D\D\D\Dw\D’</regex>
	<description>World-writable File</description>
</rule>

<rule id="100019" level="0">
	<if_sid>100018</if_sid>
	<regex>Permissions changed from ‘\D\D\D\D\D\D\Dw\D’ to ‘\D+’</regex>
	<description>World-writable File</description>
</rule>

	<!--
	 Ignore mimecast as they always block with this error message the first time. /Kristofer
	-->

<rule id="100020" level="0">
	<if_sid>3330</if_sid>
	<match>Mimecast_SMTP_Error_Codes</match>
	<description>Ignore mimecast as they always block the first time.</description>
</rule>

<!--
 Don't alert if "failure" is on seperate hosts. This is needed since even successful
 ldap logins are logged as failures by pam_unix before pam_ldap is even attempted.
 Without this fabric logins on parallell hosts generate OSSEC alerts. /Kristofer
-->

<rule id="5551" level="10" frequency="6" timeframe="180" overwrite="yes">
	<if_matched_sid>5503</if_matched_sid>
	<same_source_ip />
	<same_location />
	<description>Multiple failed logins in a small period of time on the same host.</description>
	<group>authentication_failures,</group>
</rule>


<!--- adding more alert level to ssh brute forces. We only have vpn so it there is ssh brute going on we are in trubel.
Incresing alert level to 16 -->

<rule id="5710" level="16" overwrite="yes">
	<if_sid>5700</if_sid>
	<match>illegal user|invalid user</match>
	<description>Attempt to login using a non-existent user</description>
	<group>invalid_login,</group>
</rule>

<rule id="5712" level="16" frequency="6" timeframe="120" ignore="60" overwrite="yes" >
	<if_matched_sid>5710</if_matched_sid>
	<description>SSHD brute force trying to get access to </description>
	<description>the system.</description>
	<same_source_ip />
	<group>authentication_failures,</group>
</rule>

<rule id="5719" level="16" frequency="6" timeframe="120" ignore="60" overwrite="yes" >
	<if_matched_sid>5718</if_matched_sid>
	<description>Multiple access attempts using a denied user.</description>
	<group>invalid_login,</group>
</rule>

<rule id="11452" level="15" frequency="10" timeframe="60" overwrite="yes">
	<if_matched_sid>11401</if_matched_sid>
	<same_source_ip />
	<description>Multiple FTP connection attempts from </description>
	<description>same source IP.</description>
	<group>recon,</group>
</rule>

<rule id="1003" level="5" maxsize="1025" overwrite="yes">
	<if_matched_sid>1003</if_matched_sid>
	<description>Non standard syslog message (size too large).</description>
</rule>

<rule id="831533" level="5" timeframe="20" frequency="6">
	<if_matched_sid>31530</if_matched_sid>
	<match>ConnectionPoint</match>
	<description>High amount of POST requests in a small period of time (likely bot).</description>
</rule>

<rule id="88554" level="5">
	<if_matched_sid>554</if_matched_sid>
	<match>VolGroup00</match>
	<category>ossec</category>
	<decoded_as>syscheck_new_entry</decoded_as>
	<description>File added to the system.</description>
	<group>syscheck,</group>
</rule>

<rule id="88555" level="5">
	<if_matched_sid>554</if_matched_sid>
	<match>audit_packed</match>
	<category>ossec</category>
	<decoded_as>syscheck_new_entry</decoded_as>
	<description>File added to the system.</description>
	<group>syscheck,</group>
</rule>

<rule id="88556" level="5">
	<if_matched_sid>554</if_matched_sid>
	<match>mysqld-bin</match>
	<category>ossec</category>
	<decoded_as>syscheck_new_entry</decoded_as>
	<description>File added to the system.</description>
	<group>syscheck,</group>
</rule>

<rule id="30119" level="5" frequency="6" timeframe="120" overwrite="yes">
	<if_matched_sid>30118</if_matched_sid>
	<same_source_ip />
	<srcip>10.101.1.13</srcip>
	<description>Multiple attempts blocked by Mod Security.</description>
	<group>access_denied,</group>
</rule>

<rule id="100500" level="0">
	<if_sid>554</if_sid>
	<match>/var/log</match>
	<description>File added to the system in /var/log. - Rule created 151130</description>
</rule>

<rule id="100501" level="0">
	<if_sid>550</if_sid>
	<match>/var/log</match>
	<description>Ignoring rule 550 when Integrity checksum changed in /var/log. - Rule created 151130</description>
</rule>

<rule id="100507" level="0">
	<if_sid>552</if_sid>
	<if_matched_regex>*failed_syslog_events-*</if_matched_regex>
	<description>Integrity checksum changed - Rule created 151130</description>
</rule>

<rule id="100508" level="0">
	<if_sid>551</if_sid>
	<if_matched_regex>*failed_syslog_events-*</if_matched_regex>
	<description>Integrity checksum changed - Rule created 151130</description>
</rule>

<rule id="100509" level="0">
	<if_sid>31533</if_sid>
	<match>/elasticsearch</match>
	<srcip>31.211.203.114</srcip>
	<description>High amounts of posts when filtering in Kibana - Rule created 151130</description>
</rule>

<rule id="100510" level="0">
	<if_sid>554</if_sid>
	<match>/etc/lvm/archive</match>
	<description>File added to the system in /etc/lvm/archive, happens during mysql backup. - Rule created 151130</description>
</rule>

<rule id="31533" level="10" frequency="10" timeframe="10" overwrite="yes">
        <same_source_ip />
        <if_matched_regex>*partner.rentalcar.com*</if_matched_regex>
        <description>High amount of POST requests. Trigger if more than 10 in 10s. - Rule created 151130</description>
</rule>

</group>


<group name="wh">

<rule id="100101" level="0">
<if_level>3</if_level>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>whitehat scan</description>
</rule>

<!-- We need to use "match" if the IP is not being decoded -->
<rule id="100122" level="0">
<if_level>3</if_level>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>whitehat scan</description>
</rule>

<rule id="100123" level="0">
	<if_level>3</if_level>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>whitehat scan</description>
</rule>

<!-- We need to use "match" if the IP is not being decoded -->
<rule id="100102" level="0">
	<if_level>3</if_level>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>whitehat scan</description>
</rule>

<rule id="100124" level="0">
	<if_level>3</if_level>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>whitehat scan</description>
</rule>

<!-- We need to use "match" if the IP is not being decoded -->
<rule id="1001125" level="0">
	<if_level>3</if_level>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>whitehat scan</description>
</rule>

<rule id="100502" level="0">
	<if_sid>31153</if_sid>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>Multiple web attacks from WhiteHat - Rule created 151130</description>
</rule>

<rule id="100503" level="0">
	<if_sid>31122</if_sid>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>Ignore if source is from WhiteHat - Rule created 151130</description>
</rule>

<rule id="100504" level="0">
	<if_sid>31151</if_sid>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>Multiple web server 400 error codes from WhiteHat - Rule created 151130</description>
</rule>

<rule id="100505" level="0">
	<if_sid>31533</if_sid>
	<srcip>167.78.0.0/16</srcip>
	<srcip>63.128.163.0/27</srcip>
	<srcip>64.244.165.6</srcip>
	<srcip>38.122.74.18</srcip>
	<srcip>12.248.108.202</srcip>
	<srcip>67.207.113.226</srcip>
	<description>High amount of posts from Florida state IPs or WhiteHat - Rule created 151130</description>
</rule>

</group>


<group name="openvas">

<rule id="100103" level="0">
	<if_level>3</if_level>
	<srcip>10.101.1.13</srcip>
	<description>Openvas scan</description>
</rule>

<!-- We need to use "match" if the IP is not being decoded -->
<rule id="100104" level="0">
	<if_level>3</if_level>
	<match>10.101.1.13</match>
	<description>Openvas scan</description>
</rule>

<rule id="100506" level="0">
	<if_sid>30119</if_sid>
	<srcip>10.101.1.13</srcip>
	<srcip>10.100.1.13</srcip>
	<description>Multiple attempts blocked by Mod Security. Caused by OpenVAS - Rule created 151130</description>
</rule>

</group>
